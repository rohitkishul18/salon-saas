<div *ngIf="branchData" class="space-y-6 px-2 pb-20 min-h-screen bg-gray-50">

  <!-- Branch Banner (Optional, commented out as per previous) -->
  <!-- <section class="w-full h-[280px] rounded-xl overflow-hidden shadow-lg relative">
    <img [src]="branchData.bannerImage" alt="{{ branchData.name }} Banner" class="w-full h-full object-cover">
    <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
    <div class="absolute bottom-4 left-4 text-white">
      <h1 class="text-3xl font-bold">{{ branchData.name }}</h1>
    </div>
  </section> -->

  <!-- Branch Info -->
  <section class="bg-white rounded-xl shadow-sm p-6 space-y-3">
    <h1 class="text-2xl md:text-3xl font-bold text-gray-900">{{ branchData.name }} Branch</h1>
    <p class="text-gray-600 text-base leading-relaxed">{{ branchData.address }}</p>
    
    <div class="flex flex-col sm:flex-row gap-4 pt-3 border-t border-gray-100">
      <div class="flex items-center gap-2">
        <span class="font-bold text-xl text-yellow-500">{{ branchData.rating }}</span>
        <span class="text-yellow-400 text-lg">★</span>
        <span class="text-gray-500 text-sm">({{ branchData.reviewCount }} reviews)</span>
      </div>
      <div class="flex items-center gap-2 text-sm text-gray-600">
        <span class="material-icons text-base">phone</span>
        <a href="tel:{{ branchData.phone }}" class="font-medium hover:text-blue-600 transition-colors">{{ branchData.phone }}</a>
      </div>
    </div>

    <div class="flex items-center gap-3 text-sm text-gray-600">
      <span class="material-icons text-base">access_time</span>
      <span class="font-medium">Open: {{ branchData.openingHours?.from }} - {{ branchData.openingHours?.to }}</span>
      <span class="text-green-600 font-semibold">Open Now</span> <!-- Dynamic check later -->
    </div>
  </section>

  <!-- Services -->
  <section class="bg-white rounded-xl shadow-sm p-6">
    <h2 class="text-xl md:text-2xl font-semibold mb-4 text-gray-900">Our Services at {{ branchData.name }}</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div *ngFor="let svc of services" class="p-4 border border-gray-200 rounded-lg hover:shadow-md transition-all duration-200 cursor-pointer" (click)="selectService(svc._id)">
        <h3 class="font-semibold text-gray-900 mb-1">{{ svc.name }}</h3>
        <p class="text-gray-600 text-sm mb-2">{{ svc.description || 'Premium service for your needs' }}</p>
        <div class="flex justify-between items-center">
          <span class="text-2xl font-bold text-blue-600">₹{{ svc.price }}</span>
          <span class="text-sm text-gray-500">{{ svc.durationMinutes }} mins</span>
        </div>
        <button 
          class="mt-2 w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium text-sm"
          (click)="selectService(svc._id); $event.stopPropagation()">
          Select Service
        </button>
      </div>
    </div>
  </section>

  <!-- Booking Form -->
  <section class="bg-white rounded-xl shadow-sm p-4 md:p-6">
    <h2 class="text-xl md:text-2xl font-semibold mb-4 text-gray-900">Book Your Appointment</h2>
    <form  (ngSubmit)="submitBooking()" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
        <input 
          type="text" 
          formControlName="customerName" 
          placeholder="Enter your full name"
          class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
          [class.border-red-500]="bookingForm.get('customerName')?.invalid && bookingForm.get('customerName')?.touched" />
        <div *ngIf="bookingForm.get('customerName')?.invalid && bookingForm.get('customerName')?.touched" class="text-red-500 text-xs mt-1">
          Name is required.
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number *</label>
        <input 
          type="tel" 
          formControlName="customerPhone" 
          placeholder="Enter your phone number (10 digits)"
          class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
          [class.border-red-500]="bookingForm.get('customerPhone')?.invalid && bookingForm.get('customerPhone')?.touched" />
        <div *ngIf="bookingForm.get('customerPhone')?.invalid && bookingForm.get('customerPhone')?.touched" class="text-red-500 text-xs mt-1">
          Valid 10-digit phone is required.
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Service *</label>
        <select 
          formControlName="serviceId" 
          class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all appearance-none"
          [class.border-red-500]="bookingForm.get('serviceId')?.invalid && bookingForm.get('serviceId')?.touched">
          <option value="">Select a service</option>
          <option *ngFor="let svc of services" [value]="svc._id">{{ svc.name }} - ₹{{ svc.price }} ({{ svc.durationMinutes }} mins)</option>
        </select>
        <div *ngIf="bookingForm.get('serviceId')?.invalid && bookingForm.get('serviceId')?.touched" class="text-red-500 text-xs mt-1">
          Please select a service.
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Appointment Date & Time *</label>
        <input 
          type="datetime-local" 
          formControlName="scheduledAt" 
          class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
          [min]="minDateTime"
          [class.border-red-500]="bookingForm.get('scheduledAt')?.invalid && bookingForm.get('scheduledAt')?.touched" />
        <div *ngIf="bookingForm.get('scheduledAt')?.invalid && bookingForm.get('scheduledAt')?.touched" class="text-red-500 text-xs mt-1">
          Select a future date and time.
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Notes (Optional)</label>
        <textarea 
          formControlName="notes" 
          placeholder="Any special instructions?"
          rows="3"
          class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none"></textarea>
      </div>

      <button 
        type="submit" 
        class="w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-200 shadow-md disabled:opacity-50 disabled:cursor-not-allowed"
        [disabled]="bookingForm.invalid">
        Book Now
      </button>
    </form>
  </section>

</div>

<div *ngIf="!branchData" class="flex items-center justify-center min-h-screen">
  <div class="text-center">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
    <p class="text-gray-600">Loading branch details...</p>
  </div>
</div>